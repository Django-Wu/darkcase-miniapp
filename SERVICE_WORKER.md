# Service Worker для офлайн режима

## Реализованные функции

### 1. Автоматическая регистрация Service Worker
- ✅ Service Worker регистрируется автоматически при загрузке приложения
- ✅ Автоматическое обновление при наличии новой версии
- ✅ Периодическая проверка обновлений (каждые 60 секунд)

### 2. Стратегии кэширования

#### API запросы (Network First)
- Стратегия: Network First с fallback на кэш
- Кэш: `api-cache`
- Срок хранения: 24 часа
- Максимум записей: 50
- Timeout: 10 секунд

#### Изображения (Cache First)
- Стратегия: Cache First
- Кэш: `images-cache`
- Срок хранения: 30 дней
- Максимум записей: 100
- Типы: PNG, JPG, JPEG, SVG, GIF, WebP

#### Видео (Cache First)
- Стратегия: Cache First с поддержкой range requests
- Кэш: `videos-cache`
- Срок хранения: 7 дней
- Максимум записей: 20
- Типы: MP4, WebM, OGG

#### Внешние ресурсы
- Google Fonts: Cache First, 1 год
- Telegram WebApp script: Cache First, 7 дней

### 3. Офлайн страница
- ✅ Создана `/offline.html` для отображения при отсутствии интернета
- ✅ Автоматическая перезагрузка при восстановлении соединения
- ✅ Красивый UI в стиле приложения

### 4. PWA манифест
- ✅ Настроен `manifest.json` для установки как PWA
- ✅ Иконки для разных размеров (192x192, 512x512)
- ✅ Shortcuts для быстрого доступа
- ✅ Темная тема

### 5. Индикатор офлайн режима
- ✅ Компонент `OfflineIndicator` показывает статус подключения
- ✅ Уведомления при переходе в офлайн/онлайн режим
- ✅ Автоматическое скрытие через 3 секунды

## Как это работает

### При первом посещении:
1. Service Worker регистрируется
2. Кэшируются статические ресурсы (JS, CSS, HTML)
3. Кэшируются изображения при загрузке
4. API запросы кэшируются после успешного ответа

### В офлайн режиме:
1. Статические ресурсы загружаются из кэша
2. API запросы возвращают кэшированные данные
3. Изображения загружаются из кэша
4. Видео загружаются из кэша (если были закэшированы)
5. Показывается офлайн страница при навигации на несуществующую страницу

### При восстановлении соединения:
1. Service Worker проверяет обновления
2. Показывается уведомление о восстановлении
3. Данные синхронизируются с сервером
4. Кэш обновляется новыми данными

## Тестирование

### Проверка Service Worker:
1. Откройте DevTools → Application → Service Workers
2. Убедитесь, что Service Worker зарегистрирован
3. Проверьте кэши в Application → Cache Storage

### Тестирование офлайн режима:
1. Откройте DevTools → Network
2. Выберите "Offline" в режиме сети
3. Обновите страницу - приложение должно работать
4. Проверьте, что данные загружаются из кэша

### Проверка обновлений:
1. Измените код и пересоберите проект
2. Service Worker автоматически обновится
3. Пользователь увидит уведомление об обновлении

## Оптимизация

### Рекомендации:
1. **Не кэшируйте большие видео** - используйте внешние CDN
2. **Ограничивайте размер кэша** - используйте `maxEntries`
3. **Регулярно очищайте старый кэш** - используйте `maxAgeSeconds`
4. **Мониторьте использование кэша** - проверяйте в DevTools

### Настройка кэширования:
Отредактируйте `vite.config.ts` для изменения стратегий кэширования:
- `NetworkFirst` - для данных, которые должны быть актуальными
- `CacheFirst` - для статических ресурсов
- `StaleWhileRevalidate` - для ресурсов, которые можно обновить в фоне

## Производство

После сборки проекта:
```bash
npm run build
```

Service Worker будет автоматически сгенерирован в `dist/sw.js`.

Проверьте:
- `dist/sw.js` - Service Worker файл
- `dist/manifest.json` - PWA манифест
- `dist/offline.html` - офлайн страница

## Поддержка браузеров

Service Worker поддерживается в:
- ✅ Chrome/Edge (все версии)
- ✅ Firefox (с версии 44)
- ✅ Safari (с версии 11.1)
- ✅ Opera (с версии 40)
- ⚠️ Internet Explorer (не поддерживается)

## Безопасность

- Service Worker работает только на HTTPS (или localhost)
- Кэш изолирован для каждого домена
- API запросы кэшируются только с разрешенных доменов

